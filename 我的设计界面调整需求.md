# æˆ‘çš„è®¾è®¡ï¼ˆUICreateï¼‰ç•Œé¢é‡æ„ PRD

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 æ ¸å¿ƒé—®é¢˜
å½“å‰ã€Œæˆ‘çš„è®¾è®¡ã€é¡µé¢é‡‡ç”¨ä¸‰æ­¥èµ°æµç¨‹ï¼ˆéœ€æ±‚è¾“å…¥ â†’ è®¾è®¡è°ƒæ•´ â†’ å¯¼å‡ºï¼‰ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- Figma åµŒå…¥ç»é¢„ç ”ä¸å¯è¡Œï¼Œå½“å‰é¢„è§ˆæ˜¯ç¡¬ç¼–ç çš„é™æ€ç™»å½•é¡µ JSXï¼ˆUICreate.tsx:458-537ï¼‰
- AI å¯¹è¯åªè¿½åŠ èŠå¤©æ¶ˆæ¯ï¼Œä¸æ›´æ–°é¢„è§ˆå†…å®¹ï¼ˆUICreate.tsx:125-144ï¼‰
- å¯¼å‡ºåªæ˜¯ toast æç¤ºï¼Œæ— çœŸå®æ–‡ä»¶ç”Ÿæˆï¼ˆUICreate.tsx:561-593ï¼‰
- ç¼–è¾‘æ¨¡å¼é  `setCurrentStep(2)` è·³æ­¥ï¼Œé‡æ„åä¼šå¤±æ•ˆï¼ˆUICreate.tsx:79ï¼‰

### 1.2 ç›®æ ‡
æ”¹ä¸º HTML è¾“å‡ºæ–¹æ¡ˆï¼š75% é¢ç§¯çš„ iframe HTML é¢„è§ˆ + åº•éƒ¨ AI è¾“å…¥æ ï¼ŒAI ç”Ÿæˆå®Œæ•´ HTML+CSS ä»£ç æ¸²æŸ“åˆ° iframeï¼Œæ”¯æŒè¿­ä»£è°ƒæ•´ã€‚

---

## 2. å¸ƒå±€è®¾è®¡

```
â”Œâ”€ StepIndicatorï¼ˆç®€åŒ–ä¸ºï¼šè®¾è®¡ â†’ å¯¼å‡ºï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”œâ”€ é¡¶éƒ¨ä¿¡æ¯æ ï¼ˆ56pxï¼‰ï¼šå…³è”PRD + å…³è”é¡¹ç›® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å°ºå¯¸åˆ‡æ¢ï¼šæ‰‹æœº | å¹³æ¿ | æ¡Œé¢]                         â”‚
â”‚                                                           â”‚
â”‚  HTML é¢„è§ˆåŒºåŸŸï¼ˆiframeï¼Œå æ»¡å‰©ä½™ç©ºé—´ï¼Œçº¦ 75%ï¼‰           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â”‚  åˆå§‹ï¼šç©ºç™½å ä½ + æç¤ºæ–‡æ¡ˆ                        â”‚    â”‚
â”‚  â”‚  ç”Ÿæˆåï¼šAI ç”Ÿæˆçš„ HTML+CSS å®æ—¶æ¸²æŸ“              â”‚    â”‚
â”‚  â”‚                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                           â”‚
â”œâ”€ åº•éƒ¨å¸é™„æ“ä½œæ ï¼ˆ~160pxï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [AI å›å¤æ‘˜è¦ - å¯æŠ˜å ]                                  â”‚
â”‚  AI è¾“å…¥æ¡†ï¼ˆè‡ªé€‚åº” 60-120pxï¼‰                             â”‚
â”‚  [ğŸ“ ä¸Šä¼ å‚è€ƒå›¾]                                [â†‘ å‘é€] â”‚
â”‚  [ğŸ’¾ ä¿å­˜è‰ç¨¿]                                 [ä¸‹ä¸€æ­¥ >] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. å…³é”®è®¾è®¡å†³ç­–

### 3.1 ç±»å‹ç³»ç»Ÿè¡¥å…¨ï¼šæ–°å¢ htmlContent å­—æ®µ

**ç°çŠ¶é—®é¢˜**ï¼šUIDesignVersion åªæœ‰ `componentTree?: string`ï¼Œæ²¡æœ‰å­˜å‚¨ HTML å†…å®¹çš„å­—æ®µã€‚

**æ–¹æ¡ˆ**ï¼šåœ¨ç±»å‹å’Œç‰ˆæœ¬æ„å»ºä¸­æ–°å¢ `htmlContent` å­—æ®µï¼š

```typescript
// src/types/index.ts
export interface UIDesignVersion extends VersionBase {
  // ...existing fields...
  componentTree?: string;   // ä¿ç•™ï¼Œå‘åå…¼å®¹
  htmlContent?: string;     // æ–°å¢ï¼šAI ç”Ÿæˆçš„å®Œæ•´ HTML+CSS ä»£ç 
}

export interface UIDesignItem {
  // ...existing fields...
  htmlContent?: string;     // æ–°å¢ï¼šå½“å‰ç‰ˆæœ¬çš„ HTML å†…å®¹
}
```

**ä»£ç å½±å“**ï¼š
- `src/types/index.ts`ï¼šUIDesignVersion (line 37) å’Œ UIDesignItem (line 76) æ–°å¢å­—æ®µ
- `src/store/AppContext.tsx`ï¼š
  - UIDesignInput ç±»å‹ (line 93) æ–°å¢ `htmlContent?: string`
  - `buildUIDesignVersion` (line 927) æ–°å¢ `htmlContent` ä¼ é€’
  - `createUIDesignVersion` (line 55) çš„ next å‚æ•°ç±»å‹æ–°å¢ `htmlContent`
  - `addUIDesign` ç›¸å…³é€»è¾‘åŒæ­¥æ›´æ–°

### 3.2 AI å¯¹è¯ä¸é¢„è§ˆè”åŠ¨ï¼ˆä¸»é“¾è·¯ï¼‰

**æ ¸å¿ƒæµç¨‹**ï¼š
```
ç”¨æˆ·è¾“å…¥è®¾è®¡éœ€æ±‚ â†’ AI è¿”å›å®Œæ•´ HTML+CSS â†’ æ›´æ–° htmlCode state â†’ iframe srcdoc åˆ·æ–°
```

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
const [htmlCode, setHtmlCode] = useState<string>('');  // å½“å‰ HTML å†…å®¹
const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
```

**AI æ¶ˆæ¯å¤„ç†**ï¼ˆæ›¿æ¢ç°æœ‰ UICreate.tsx:125-144 çš„ mock é€»è¾‘ï¼‰ï¼š
```typescript
const handleSendMessage = async (message: string) => {
  // 1. è¿½åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©è®°å½•
  // 2. è°ƒç”¨ AIï¼ˆmockï¼šè¿”å›é¢„è®¾ HTML æ¨¡æ¿ï¼Œèå…¥ç”¨æˆ·éœ€æ±‚æè¿°ï¼‰
  // 3. ä» AI å“åº”ä¸­æå– HTML ä»£ç 
  // 4. setHtmlCode(newHtml) â†’ iframe è‡ªåŠ¨æ›´æ–°
  // 5. è¿½åŠ  AI å›å¤åˆ°èŠå¤©è®°å½•
};
```

**é¦–æ¬¡ç”Ÿæˆ vs è¿­ä»£è°ƒæ•´**ï¼š
- é¦–æ¬¡ï¼šç”¨æˆ·æè¿°éœ€æ±‚ â†’ AI ç”Ÿæˆå®Œæ•´ HTML é¡µé¢
- è¿­ä»£ï¼šç”¨æˆ·æè¿°è°ƒæ•´ â†’ AI è¿”å›æ›´æ–°åçš„å®Œæ•´ HTMLï¼ˆæ¯æ¬¡éƒ½æ˜¯å…¨é‡æ›¿æ¢ï¼‰

### 3.3 iframe å®‰å…¨ç­–ç•¥

**å†³ç­–**ï¼šä¸å¼€å¯ `allow-scripts`ï¼Œåªæ¸²æŸ“é™æ€ HTML+CSSã€‚

```html
<iframe
  sandbox=""
  srcdoc={htmlCode}
  title="è®¾è®¡é¢„è§ˆ"
  style={{ width: '100%', height: '100%', border: 'none' }}
/>
```

- `sandbox=""` ä¸å¸¦ä»»ä½• allow-* æƒé™ï¼Œæœ€å®‰å…¨
- è¶³å¤Ÿæ¸²æŸ“é™æ€ HTML+CSS å¸ƒå±€é¢„è§ˆ
- å¦‚æœåç»­éœ€è¦äº¤äº’é¢„è§ˆï¼ˆåŠ¨ç”»ã€hover æ•ˆæœï¼‰ï¼Œå†æŒ‰éœ€å¼€å¯ `allow-scripts`

### 3.4 æœ¬åœ°è‰ç¨¿å­˜å‚¨

ä¸éœ€æ±‚é¡µé¢æ–¹æ¡ˆä¸€è‡´ï¼š
- æ–°å¢ localStorage keyï¼š`lexin_draft_ui_{entityId}` / `lexin_draft_ui_new`
- å­˜å‚¨å†…å®¹ï¼š`{ htmlCode, requirement, selectedPRD, selectedProjectId, chatMessages, updatedAt }`
- èŠ‚æµä¿å­˜ï¼šhtmlCode æˆ– chatMessages å˜åŒ–å 1 ç§’èŠ‚æµå†™å…¥
- é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è‰ç¨¿ï¼Œæç¤ºæ¢å¤

### 3.5 ä¿å­˜/ç‰ˆæœ¬æ—¶æœº

**çŠ¶æ€æœº**ï¼š
```
[è®¾è®¡ä¸­] --ç‚¹å‡»ã€Œä¿å­˜è‰ç¨¿ã€--> [è‰ç¨¿å·²ä¿å­˜åˆ° localStorage]
[è®¾è®¡ä¸­] --ç‚¹å‡»ã€Œä¸‹ä¸€æ­¥ã€--> [è½åº“åˆ° AppContext + è§¦å‘å¯¼å‡ºå¼¹çª—]
[å¯¼å‡ºå¼¹çª—] --ç‚¹å‡»ã€Œå®Œæˆã€--> [æ¸…é™¤è‰ç¨¿ + è·³è½¬åˆ—è¡¨é¡µ]
[å¯¼å‡ºå¼¹çª—] --ç‚¹å‡»ã€Œè¿”å›ç¼–è¾‘ã€--> [å›åˆ°è®¾è®¡ä¸­]
```

- åªåœ¨ã€Œä¸‹ä¸€æ­¥ã€æ—¶æ‰§è¡Œä¸€æ¬¡ `addUIDesign` / `createUIDesignVersion`ï¼ˆå« htmlContentï¼‰
- å¼¹çª—æ‰“å¼€æ—¶ç¦ç”¨ StepIndicator ç‚¹å‡»

### 3.6 ç¼–è¾‘æ¨¡å¼é©±åŠ¨æ–¹å¼

**ç°çŠ¶é—®é¢˜**ï¼šç¼–è¾‘æ¨¡å¼é  `setCurrentStep(2)` è·³æ­¥ï¼Œé‡æ„å Step 1/2 å·²åˆå¹¶ã€‚

**æ–°æ–¹æ¡ˆ**ï¼šç”±ã€Œæ˜¯å¦æœ‰æ—¢æœ‰å†…å®¹ã€é©±åŠ¨æ¸²æŸ“ï¼š
```typescript
const isEditMode = !!editUIDesign;
// ç¼–è¾‘æ¨¡å¼ï¼šä» editUIDesign åŠ è½½ htmlContent åˆ° htmlCode
// æ–°å»ºæ¨¡å¼ï¼šhtmlCode ä¸ºç©ºï¼Œæ˜¾ç¤ºç©ºç™½å ä½
useEffect(() => {
  if (editUIDesign) {
    setHtmlCode(editUIDesign.htmlContent || '');
    setRequirement(editUIDesign.description);
    // ä¸å† setCurrentStep
  }
}, [editUIDesign]);
```

### 3.7 å¯¼å‡ºæ–¹æ¡ˆ

**MVP é¦–ç‰ˆ**ï¼šåªå®ç° HTML æ–‡ä»¶ä¸‹è½½ï¼ŒPNG æ”¾äºŒæœŸã€‚

| å¯¼å‡ºæ ¼å¼ | å®ç°æ–¹å¼ | ä¼˜å…ˆçº§ |
|----------|----------|--------|
| HTML æ–‡ä»¶ | `Blob` + `URL.createObjectURL` ä¸‹è½½ .html æ–‡ä»¶ | P0 é¦–ç‰ˆ |
| PNG å›¾ç‰‡ | `html2canvas` æˆ–æœåŠ¡ç«¯æˆªå›¾ | P2 äºŒæœŸ |

**ä»£ç å®ç°**ï¼š
```typescript
const handleExportHTML = () => {
  const blob = new Blob([htmlCode], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${title || 'è®¾è®¡ç¨¿'}.html`;
  a.click();
  URL.revokeObjectURL(url);
};
```

### 3.8 StepIndicator ä¸å¼¹çª—åè°ƒ

- å¯¼å‡ºå¼¹çª—æ‰“å¼€æ—¶ï¼ŒStepIndicator ç¦ç”¨ç‚¹å‡»
- Step çŠ¶æ€ï¼šè®¾è®¡ä¸­=Step1ï¼Œå¯¼å‡ºå¼¹çª—æ‰“å¼€=Step2
- å…³é—­å¼¹çª—è‡ªåŠ¨å›é€€ Step çŠ¶æ€

---

## 4. å“åº”å¼é¢„è§ˆå°ºå¯¸åˆ‡æ¢

é¡¶éƒ¨ä¿¡æ¯æ æä¾›å°ºå¯¸åˆ‡æ¢æŒ‰é’®ï¼š

| å°ºå¯¸ | iframe å®½åº¦ | è¯´æ˜ |
|------|-------------|------|
| æ‰‹æœº | 375px | iPhone SE åŸºå‡† |
| å¹³æ¿ | 768px | iPad åŸºå‡† |
| æ¡Œé¢ | 100% | å æ»¡é¢„è§ˆåŒº |

iframe å±…ä¸­æ˜¾ç¤ºï¼Œè¶…å‡ºéƒ¨åˆ†å¯æ»šåŠ¨ã€‚

---

## 5. æ¶‰åŠæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|
| `src/types/index.ts` | ä¿®æ”¹ | UIDesignVersion + UIDesignItem æ–°å¢ htmlContent |
| `src/store/AppContext.tsx` | ä¿®æ”¹ | ç±»å‹æ›´æ–° + è‰ç¨¿å­˜å‚¨ + ç‰ˆæœ¬æ„å»º |
| `src/pages/UICreate.tsx` | é‡æ„ | ä¸»é¡µé¢å¸ƒå±€é‡æ„ |
| `src/components/HTMLPreview.tsx` | æ–°å¢ | iframe é¢„è§ˆå°è£… + å°ºå¯¸åˆ‡æ¢ |
| `src/components/AIInputBar.tsx` | å¤ç”¨ | åº•éƒ¨ AI è¾“å…¥æ ï¼ˆä¸éœ€æ±‚é¡µå…±äº«ï¼‰ |
| `src/components/UIExportDialog.tsx` | æ–°å¢ | å¯¼å‡ºå¼¹çª— |

---

## 6. å®æ–½é¡ºåºï¼ˆå…ˆåŸºç¡€åé¡µé¢ï¼‰

1. **ç±»å‹è¡¥å…¨**ï¼štypes/index.ts æ–°å¢ htmlContent å­—æ®µ
2. **AppContext æ›´æ–°**ï¼šç‰ˆæœ¬æ„å»ºã€ç±»å‹ç­¾åã€è‰ç¨¿å­˜å‚¨
3. **HTMLPreview ç»„ä»¶**ï¼šiframe å°è£… + å°ºå¯¸åˆ‡æ¢
4. **AIInputBar ç»„ä»¶**ï¼šåº•éƒ¨è¾“å…¥æ ï¼ˆä¸¤é¡µé¢å…±ç”¨ï¼Œå…ˆåšè¿™ä¸ªï¼‰
5. **UICreate.tsx é‡æ„**ï¼šä¸»é¡µé¢å¸ƒå±€
6. **UIExportDialog ç»„ä»¶**ï¼šå¯¼å‡ºå¼¹çª—

---

## 7. ä¸åšçš„äº‹ï¼ˆæ˜ç¡®æ’é™¤ï¼‰

- ä¸å®ç° PNG å¯¼å‡ºï¼ˆäºŒæœŸï¼‰
- ä¸å¼€å¯ iframe allow-scriptsï¼ˆMVP åªæ¸²æŸ“é™æ€ HTML+CSSï¼‰
- ä¸å®ç°çœŸå® AI API è°ƒç”¨ï¼ˆä¿æŒ mockï¼Œä½† mock è¿”å› HTML è€Œéçº¯æ–‡æœ¬ï¼‰
- ä¸ä¿ç•™ Figma/Pencil å·¥å…·é€‰æ‹©ï¼ˆå·²ç¡®è®¤ Figma ä¸å¯è¡Œï¼Œç»Ÿä¸€ä¸º HTML è¾“å‡ºï¼‰
- ä¸æ”¹åŠ¨ UIList.tsx åˆ—è¡¨é¡µï¼ˆé¢„è§ˆç¼©ç•¥å›¾åç»­å†å¤„ç†ï¼‰
